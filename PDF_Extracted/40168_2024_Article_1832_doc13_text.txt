# Quality control and assembly of metagenomic datasets

Raw reads from the VLP and bulk metagenomic datasets were preprocessed using fastp v.0.23.2 [65] with adapter and polyG tail trimming, and low-quality reads were removed if the length was less than 60 bp or over more than 30% of them had an average Phred quality score of less than 20. The preprocessed reads were then aligned to the human genome (GRCh38) and the Escherichia phage phiX174 genome (NCBI accession NC_001422.1). Any reads that mapped to these genomes were excluded, and the remaining reads were recognized as clean reads for each sample. Next, the clean reads from each sample were subjected to contig assembly using MEGAHIT v1.2.967 [66] with the parameters: “–k-list 21,41,61,81,101,121,141”.

# Identification and clustering of viral sequences

We identified viral sequences using a well-established method described in our previous studies [18, 26]. Only contigs exceeding a length of 2000 bp were used for this analysis. Firstly, these contigs were assessed using CheckV v0.7.0 [28]. Those containing more than ten host genes, exceeding five times the number of viral genes, were excluded from further consideration. Among the remaining contigs, potential viral sequences were identified if they met any of the following criteria: (1) contigs with a higher count of viral genes in comparison to host genes, as determined by CheckV v0.7.0 [28]; (2) contigs with a score > 0.90 and a p-value < 0.01 in DeepVirFinder v1.0 [67]; and (3) contigs that were identified as viruses using default parameters in VIBRANT v1.2.1 [68]. To minimize non-viral sequence contamination, we conducted a search for bacterial universal single-copy orthologs (BUSCOs) within the potential viral sequences using hmmsearch [69]. We then calculated the BUSCO ratio, which measures the ratio of BUSCO counts to the total gene counts within each viral sequence, to assess potential contamination levels. Any sequence exhibiting ≥ 5% BUSCO ratio was then removed from the analysis. The remaining sequences, which possessed a CheckV-estimated completeness exceeding 50%, were assigned as the final viral genomes. To further improve the quality of the viral genomes and deduplicate genomes, we utilized a large gut viral genome database known as cnGVC [26]. In short, we clustered the viral genomes identified in our study with those in cnGVC based on criteria of 95% identity and 70% coverage. Only clusters containing at least one viral genome identified in our study were retained. Within each cluster, the longest sequence was selected as the reference sequence, which was referred to as the vOTU. In the end, we conducted a quality assessment of the genomes for all vOTUs through CheckV v0.7.0.

# Taxonomic and functional annotation and host prediction for viral sequences

The taxonomic annotation of vOTUs was conducted by aligning their protein sequences against a comprehensive database. This database was constructed by integrating proteins from various sources, including Virus-Host DB (acquired in May 2021) [70], crAss-like proteins from Guerin’s study [71], as well as viral proteins from Benler’s and Ye’s studies [71, 72]. To predict protein-coding sequences within vOTUs, we employed Prodigal v2.6.3 with the “meta” parameter [73]. Subsequently, we queried these protein sequences against the combined database using diamond v2.0.13.151 with the following parameters: “–id 30 –query-cover 50 –subject-cover 50 –min-score 50” [74]. For small vOTUs containing fewer than 30 genes, we assigned them to a known viral family if more than one-fifth of their proteins matched to a certain family. Conversely, for large vOTUs with 30 or more genes, we assigned them to a known viral family if at least 10 of their proteins matched to the same family.

To elucidate the functions of putative proteins, we used diamond v2.0.13.151 for searches against the KEGG (Kyoto Encyclopedia of Genes and Genomes) database [75], applying criteria of > 50% query coverage and > 60% score. For proteins that remained unassigned to a specific KEGG ortholog (KO), we conducted additional investigations by utilizing the PfamScan tool against Pfam database version 33.1 [34, 76].

We conducted host matching for vOTUs using two criteria within the pool of 4644 prokaryotic species from the Unified Human Gastrointestinal Genome (UHGG) database [31]. Firstly, for prokaryotic genomes, we predicted CRISPR spacer sequences using MinCED v0.4.2 with the parameter “-minNR 2” [77]. When a CRISPR spacer sequence from the host displayed a BLASTn match to a viral genome with a bit-score of 45 or greater, we assigned that virus to the corresponding host. Secondly, the virus was linked to a host if its sequence demonstrated ≥ 90% nucleotide identity and ≥ 30% viral coverage when compared to the host genome.

# Taxonomic composition of metagenomic samples

In order to mitigate the issue of false positives, we have taken three steps to regenerate the relative abundance table of vOTUs. The specific steps for generating relative abundances of vOTUs for a metagenomic sample are as follows: (1) we used Bowtie 2 with the options “–end-to-end –fast” to align all clean reads to the 10,054 vOTUs and then utilized Samtools to obtain the sequencing depth of each base position for every vOTU (including positions with a sequencing depth of 0). For each vOTU, all base positions were sorted based on their sequencing depths from lowest to highest, excluding positions.