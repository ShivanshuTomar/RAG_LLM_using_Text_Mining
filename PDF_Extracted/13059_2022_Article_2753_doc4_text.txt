# Ma et al. Genome Biology (2022) 23:208

# 5. Comprehensive validation of MMUPHin via realistic synthetic data

We validated MMUPHin both in comparison to existing methods and through extensive simulation studies (Fig. 2), with simulated realistic microbial abundance profiles at different data dimensionality, biological/technical batch signal strength, and discrete/continuous population structures (“Methods,” Additional file 1: Figs. S6-S10, Additional file 4: Table S2). These simulations were designed to be complementary to our application to and assessment of the IBD microbiome as described below, since they allow analysis of a controlled ground truth of outcome-associated and null microbial elements that is lacking in uncontrolled population settings. As detailed in “Methods,” our simulation approach (a) generates realistic microbial profiles, so that the evaluation findings are generalizable to the appropriate target populations, and (b) is neutral to the evaluated methods (ComBat, quantile normalization, MMUPHin, etc.).

MMUPHin_Correct successfully reduced variability attributable to technical effects in simulated microbial profiles, as first quantified by the PERMANOVA R2 statistic [38] (Fig. 2a, b, Additional file 1: Fig. S6). This was true both in terms of reducing the overall microbial variability attributable to technical artifacts and in terms of the ratio of “biological” versus technical variability (Fig. 2a). ComBat correction [15], suited for gene expression data, was capable of reducing batch effects to a lesser degree, but also tended to reduce desirable “biological” variation in the process, likely due to noise introduced by it changing many zero counts to non-zero values. Previously proposed techniques for microbial community data, namely quantile normalization [18] and BDMMA [19], are only appropriate for differential abundance analysis and do not provide batch-normalized profiles, thus precluding PERMANOVA batch effect quantification; their per-feature testing performance is evaluated together with MMUPHin_MetaDA instead. MMUPHin_Correct thus provides batch-corrected microbial community profiles that retain biologically meaningful variation more than (or not even possible using) existing methods. Subsequently, for differential abundance testing, MMUPHin_MetaDA successfully corrected for false associations when batch/cohort effects were confounded with variables of interest, which is a common concern for ‘omics meta-analysis [39].